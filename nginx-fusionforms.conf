server {
    listen 8444 ssl http2;
    server_name dev-codex.idoxgroup.local;

    ssl_certificate /etc/ssl/certs/fusionforms-selfsigned.crt;
    ssl_certificate_key /etc/ssl/private/fusionforms-selfsigned.key;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    # Serve FusionForms at /fusionforms/ path
    location /fusionforms/ {
        alias /var/www/fusionforms/;
        index index.html;
        try_files $uri $uri/ /fusionforms/index.html;
    }

    # Redirect /fusionforms to /fusionforms/
    location = /fusionforms {
        return 301 /fusionforms/;
    }

    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# Redirect HTTP to HTTPS
server {
    listen 8081;
    server_name dev-codex.idoxgroup.local;
    return 301 https://$server_name:8444$request_uri;
}
